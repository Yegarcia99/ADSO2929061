<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Parejas Todo-en-Uno (jQuery)</title>
    <link rel="stylesheet" href="../css/styles.css">
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <style>


        /* CONTENEDOR DE JUEGO (PADRE RELATIVO) */
        .container {
            background: url(images/reto/img1.png) center/cover;
            height: 800px;
            width: 508px;
            
            position: relative; /* CLAVE para posicionamiento absoluto de hijos */
            
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ESTILOS DEL MARCADOR (HIJO ABSOLUTO: superior derecho) */
        #contador-wrapper {
            position: absolute; 
            top: 60px; 
            right: 200px;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.4); 
            border-radius: 5px;
            z-index: 10; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 1em; 
            color: white; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5); 
        }

        .stat-inline {
            margin: 2px 0;
            white-space: nowrap;
        }
        .stat-inline span {
            font-weight: bold;
            color: #d9534f;
            margin-left: 5px;
        }
        
        /* --- ESTILOS DEL BOTÓN DE REINICIO (DENTRO Y CENTRADO EN LA BASE) --- */
        #restart-button {
            position: absolute; 
            bottom: 30px; /* Separación del fondo */
            left: 50%; /* Mueve el punto de inicio al centro */
            transform: translateX(-50%); /* Lo mueve hacia la izquierda la mitad de su propio ancho para centrarlo */
            
            width: 164; 
            height: 164px; 
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s;
        }
        #restart-button:active {
            transform: translateX(-50%) scale(0.95); /* Mantiene el centrado y aplica el efecto */
        }

        /* TABLERO Y GIRO 3D (Sin cambios) */
        #tablero {
            display: grid;
            grid-template-columns: repeat(4, 94px);
            gap: 10px;
            perspective: 1000px;
        }
        .card {
            width: 94px;
            height: 136px;
            cursor: pointer;
            border-radius: 5px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        /* ... el resto de estilos de giro 3D ... */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 5px;
        }
        .card-face-front {
            background: url(images/reto/carta0.png) center/cover;
        }
        .card-face-back {
            transform: rotateY(180deg); 
            overflow: hidden; 
        }
        .card.flipped {
             transform: rotateY(180deg);
        }
        .card-face-back .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            display: block; 
        }
        .card.matched {
            box-shadow: 0 0 10px #4CAF50;
        }
    </style>
</head>

<body class="css">
    <nav>
        </nav>
    
    <main>
        
        <header>
            <h1>12-challenge-memory-game</h1>
            <h2>Construye un juego de memoria usando jQuery.</h2>
        </header>

        <section class="container">
            
            <div id="contador-wrapper">
                <div class="stat-inline">Puntaje: <span id="score">0</span></div>
                <div class="stat-inline">Intentos: <span id="attempts">0</span></div>
            </div>
            
            <img id="restart-button" src="images/reto/restart.png" alt="Reiniciar juego">
            
            <div id="tablero">
                </div>
        </section>
    </main>


    <script>
        $(document).ready(function () {
            // Variables de juego (globales dentro del ready)
            let score = 0;
            let attempts = 0;
            let cardsFlipped = [];
            let lockBoard = false;
            let cards = [];
            
            const cardValues = [
                'images/reto/carta1.png',
                'images/reto/carta2.png',
                'images/reto/carta3.png',
                'images/reto/carta4.png',
                'images/reto/carta5.png',
                'images/reto/carta6.png'
            ];

            // Función de Barajado
            const shuffle = function (array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            };

            // Función para actualizar los marcadores
            function updateStats() {
                $('#score').text(score);
                $('#attempts').text(attempts);
            }

            // Función para construir y reiniciar el tablero
            function initGame() {
                // 1. Resetear variables
                score = 0;
                attempts = 0;
                cardsFlipped = [];
                lockBoard = false;
                updateStats();
                
                // 2. Barajar y limpiar el tablero
                cards = [...cardValues, ...cardValues];
                cards = shuffle(cards);
                const $tablero = $('#tablero');
                $tablero.empty(); // Limpia todas las cartas anteriores
                
                // 3. Reconstruir el tablero con las cartas barajadas
                $.each(cards, function (index, value) {
                    $tablero.append(
                        '<div class="card" data-match="' + value + '">' +
                            '<div class="card-face card-face-front"></div>' +        
                            '<div class="card-face card-face-back">' +              
                                '<img src="' + value + '" alt="Carta de juego" class="card-image">' +
                            '</div>' +
                        '</div>'
                    );
                });
            }

            // --- LÓGICA DE EVENTOS ---
            
            // Inicia el juego la primera vez
            initGame();

            // Evento de clic en el tablero
            $('#tablero').on('click', '.card:not(.matched):not(.flipped)', function () {

                if (lockBoard) return;

                const $card = $(this);
                $card.addClass('flipped');
                cardsFlipped.push($card);

                if (cardsFlipped.length === 2) {
                    lockBoard = true;
                    attempts++; 

                    if (cardsFlipped[0].data('match') === cardsFlipped[1].data('match')) {
                        // Éxito
                        score += 10; 
                        cardsFlipped[0].addClass('matched'); 
                        cardsFlipped[1].addClass('matched');
                        
                        cardsFlipped = [];
                        lockBoard = false;

                        if ($('.card:not(.matched)').length === 0) {
                            setTimeout(() => { 
                                updateStats();
                                alert(`¡Felicidades! Ganaste con ${score} puntos en ${attempts} intentos.`); 
                            }, 600);
                        }
                    } else {
                        // Fracaso
                        setTimeout(() => {
                            cardsFlipped[0].removeClass('flipped');
                            cardsFlipped[1].removeClass('flipped');
                            
                            cardsFlipped = [];
                            lockBoard = false;
                        }, 1200); 
                    }
                    
                    updateStats(); 
                }
            });
            
            // Evento de clic en el botón de reinicio
            $('#restart-button').on('click', function() {
                if (confirm('¿Estás seguro de que quieres reiniciar el juego?')) {
                    initGame();
                }
            });
            
        });
    </script>
</body>

</html>