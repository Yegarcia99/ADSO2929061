<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Parejas Todo-en-Uno (jQuery)</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <style>
        /* Centrado general para que el main se vea bien */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* CONTENEDOR DE JUEGO */
        .container {
            background: url(images/reto/img1.png);
            height: 812px;
            width: 508px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* TABLERO DE CARTAS */
        #tablero {
            display: grid;
            grid-template-columns: repeat(4, 94px);
            gap: 10px;
            /* Establece la perspectiva para el efecto 3D */
            perspective: 1000px;
        }

        /* ====================================================
        CORRECCIÓN CLAVE PARA EL EFECTO DE GIRO 3D
        ====================================================
        */
        
        .card {
            width: 94px;
            height: 136px;
            cursor: pointer;
            border-radius: 5px;

            /* Configuración del contenedor 3D */
            position: relative;
            transform-style: preserve-3d; /* Permite que los hijos se posicionen en 3D */
            transition: transform 0.6s; /* Velocidad del giro */
        }
        
        /* Contenedor de las dos caras (frontal y trasera) */
        .card-inner { /* USAMOS UN DIV INTERNO EN LUGAR DE ::before */
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        /* ESTADO: CARTA VOLTEADA (Aplica el giro al contenedor de la carta) */
        .card.flipped {
             transform: rotateY(180deg); /* EFECTO DE GIRO */
        }
        
        /* Clase común para ambas caras */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Oculta la cara cuando está girada */
            border-radius: 5px;
        }

        /* CARA FRONTAL (EL REVERSO) */
        .card-face-front {
            background: url(images/reto/carta0.png) center/cover; /* Tu imagen de reverso */
        }

        /* CARA TRASERA (LA IMAGEN DE LA CARTA) */
        .card-face-back {
            /* La imagen queda boca arriba al girar 180 grados */
            transform: rotateY(180deg); 
            overflow: hidden; 
        }

        /* Aseguramos que la imagen ocupe todo el espacio de la cara trasera */
        .card-face-back .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            display: block; 
        }
        
        /* ESTADO: PAREJA ENCONTRADA */
        .card.matched {
            box-shadow: 0 0 10px #4CAF50;
        }
    </style>
</head>

<body class="css">
    <nav>
        </nav>
    <main>
        <header>
            <h1>12-challenge-memory-game</h1>
            <h2>Description</h2>
        </header>

        <section class="container">
            <div id="tablero">
                </div>
        </section>

    </main>

    <script>
        $(document).ready(function () {

            // --- PARTE A: DATOS Y BARAJE ---
            
            // Función de Barajado (JavaScript puro, esencial para el azar)
            const shuffle = function (array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            };

            // Rutas de tus imágenes (AJUSTA ESTO CON TUS NOMBRES DE ARCHIVO REALES)
            const cardValues = [
                'images/reto/carta1.png',
                'images/reto/carta2.png',
                'images/reto/carta3.png',
                'images/reto/carta4.png',
                'images/reto/carta5.png',
                'images/reto/carta6.png'
            ];

            let cards = [...cardValues, ...cardValues];
            cards = shuffle(cards);

            let cardsFlipped = [];
            let lockBoard = false;

            // --- PARTE B: CONSTRUIR E INYECTAR EL TABLERO (jQuery) ---

            const $tablero = $('#tablero');

            // USAMOS UNA NUEVA ESTRUCTURA HTML PARA EL GIRO 3D
            $.each(cards, function (index, value) {
                $tablero.append(
                    '<div class="card" data-match="' + value + '">' +
                        '<div class="card-face card-face-front"></div>' + // El reverso (background CSS)
                        '<div class="card-face card-face-back">' +        // La cara con la imagen
                            '<img src="' + value + '" alt="Carta de juego" class="card-image">' +
                        '</div>' +
                    '</div>'
                );
            });

            // --- PARTE C: LÓGICA DE CLICS Y COMPARACIÓN (jQuery) ---

            $tablero.on('click', '.card:not(.matched):not(.flipped)', function () {

                if (lockBoard) return;

                const $card = $(this);
                $card.addClass('flipped'); // Añadir 'flipped' para iniciar el giro
                cardsFlipped.push($card);

                if (cardsFlipped.length === 2) {
                    lockBoard = true;

                    if (cardsFlipped[0].data('match') === cardsFlipped[1].data('match')) {
                        // Éxito: Se quedan giradas y se añade 'matched'
                        cardsFlipped[0].addClass('matched'); 
                        cardsFlipped[1].addClass('matched');
                        
                        cardsFlipped = [];
                        lockBoard = false;

                        if ($('.card:not(.matched)').length === 0) {
                            setTimeout(() => { alert('¡Felicidades, has ganado el juego!'); }, 600); 
                        }
                    } else {
                        // Fracaso: Volver a voltear después del giro
                        setTimeout(() => {
                            // Quitamos 'flipped' para que vuelvan a girar 
                            cardsFlipped[0].removeClass('flipped');
                            cardsFlipped[1].removeClass('flipped');

                            cardsFlipped = [];
                            lockBoard = false;
                        }, 1200); 
                    }
                }
            });
        });
    </script>
</body>

</html>