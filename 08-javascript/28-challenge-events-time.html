<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Naves Espaciales</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales */
        body {
            background: linear-gradient(to bottom, #ff9a5a 0%, #fa7f42 50%, #e25822 100%);
            font-family: 'Space Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 3.5em;
            color: #000;
            text-shadow: 2px 2px 0px #fff;
            margin: 0;
        }

        h2 {
            font-size: 1.5em;
            color: #000;
            text-shadow: 1px 1px 0px #fff;
            margin: 0;
        }

        /* Contenedores de las secciones */
        section {
            display: none;
        }

        section.active {
            display: block;
        }

        /* ESTILOS DE LA PRIMERA SECCIÓN */
        figure.two {
            background: url(images/fondo2.png) no-repeat center / cover;
            position: relative;
            margin: 0 auto;
            transition: all 0.4s ease-in;
            height: 700px;
            width: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
        }

        img.extra {
            height: 500px;
            bottom: 0;
            left: 0;
            z-index: 0;
        }

        .weapons-selector {
            position: relative;
            height: 60px;
            top: -245px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 10px 50px;
            z-index: 2;
        }

        .weapons-selector img.nave-display {
            position: relative;
            top: auto;
            left: auto;
            max-width: 90%;
            height: 60px;
            z-index: 1;
        }

        button.btn-prev {
            position: static;
            background: url(images/flecha2.svg) no-repeat center;
            width: 30px;
            height: 30px;
            border: 3px solid #b87333;
            border-radius: 50%;
            background-color: #555;
            background-size: contain;
        }

        button.btn-next {
            position: static;
            background: url(images/flecha2.svg) no-repeat center;
            width: 30px;
            height: 30px;
            border: 3px solid #b87333;
            border-radius: 50%;
            background-color: #555;
            background-size: contain;
        }

        button.btn-mode {
            background: none;
            align-items: center;
            justify-self: center;
            position: absolute;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 50px;
            border: 3px solid #b87333;
            border-radius: 50px;
            color: #fff;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            background-color: #1e063f;
            transition: all 0.1s ease;
        }

        button.btn-mode:active {
            transform: translate(-50%, 3px);
            box-shadow: 0 2px 0px #6d3ea0;
        }

        /* ESTILOS DE LA SEGUNDA SECCIÓN */
        figure.one {
            background: url(images/Fondo.png) no-repeat center / cover;
            border-radius: 4px;
            border: 4px solid #b7a63c;
            height: 600px;
            overflow: hidden;
            position: relative;
            margin: 0 auto;
            width: 400px;
        }

        .score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #ffd700;
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 2px 2px 0px #000;
            z-index: 10;
        }

        /* Estilos para el panel de información superior */
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            z-index: 10;
            color: #fff;
            font-weight: bold;
        }

        .timer-bar {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-label,
        .health-label {
            font-size: 1.2em;
            text-shadow: 1px 1px 0px #000;
        }

        .timer-fill {
            width: 150px;
            height: 20px;
            border: 2px solid #fff;
            border-radius: 10px;
            background-color: #555;
            transition: width 0.3s ease-in-out;
        }

        .health-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .health-hearts img {
            width: 30px;
            height: 30px;
        }

        /* Estilo para la nave del jugador en la segunda sección */
        #player-ship {
            position: absolute;
            bottom: 30px;
            left: 140px;
            width: 35px;
            height: auto;
            transition: left 0.2s ease-in;
            z-index: 10;
        }

        /* Estilo para los mundos que caen, generados dinámicamente */
        .world {
            position: absolute;
            top: -50px;
            width: 30px;
            height: auto;
            z-index: 5;
            transition: top linear;
        }

        /* Estilo para la explosión */
        .explosion {
            position: absolute;
            width: 80px; /* Ajusta el tamaño según tu sprite */
            height: 80px; /* Ajusta el tamaño según tu sprite */
            z-index: 12;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.1s ease-out;
        }
    </style>
</head>

<body class="javascript">
    <nav>
        <a href="index.html">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path
                    d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
            </svg>
        </a>
    </nav>
    <main>
        <header>
            <h1>Welcome</h1>
            <h2>Description</h2>
        </header>
        <section class="active" id="section-one">
            <figure class="two">
                <img src="images/extra1.png" class="extra" alt="Fondo fijo">
                <div class="weapons-selector">
                    <button class="btn-prev"></button>
                    <img src="images/nave1.svg" class="nave-display" alt="Nave seleccionada">
                    <button class="btn-next"></button>
                </div>
                <button class="btn-mode" id="btn-start">Start</button>
            </figure>
        </section>
        <section id="section-two">
            <figure class="one">
                <span class="score-display">00000</span>
                <div class="info-panel">
                    <div class="timer-bar">
                        <span class="timer-label">TIME</span>
                        <div class="timer-fill"></div>
                    </div>
                    <div class="health-container">
                        <span class="health-label">VIDA</span>
                        <div class="health-hearts">
                            <img src="images/vida.png" alt="Vida">
                            <img src="images/vida.png" alt="Vida">
                            <img src="images/vida.png" alt="Vida">
                        </div>
                    </div>
                </div>
                <img src="images/nave1.svg" id="player-ship" alt="Nave del jugador">
            </figure>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const sectionOne = document.getElementById('section-one');
            const sectionTwo = document.getElementById('section-two');
            const btnStart = document.getElementById('btn-start');

            const naveSelectorImage = document.querySelector('.weapons-selector .nave-display');
            const playerShip = document.getElementById('player-ship');
            const btnPrev = document.querySelector('.btn-prev');
            const btnNext = document.querySelector('.btn-next');
            const gameSection = document.querySelector('figure.one');

            const naves = {
                attrs: [
                    { color: 'Red', image: 'images/nave1.svg' },
                    { color: 'White', image: 'images/nave2.svg' },
                    { color: 'Blue', image: 'images/nave3.svg' },
                ]
            };

            let inx = 0;
            let isInvincible = false;
            let posX = 140;

            const worldImages = [
                'images/mundo1.svg',
                'images/mundo2.svg',
                'images/mundo3.svg',
                'images/mundo4.svg',
                'images/mundo5.svg'
            ];

            let score = 0;
            let health = 3;
            let timeLeft = 60;
            let timerInterval;
            let worldGenerationInterval;
            let collisionInterval;

            const updateNaveImage = () => {
                naveSelectorImage.src = naves.attrs[inx].image;
                playerShip.src = naves.attrs[inx].image;
            };

            btnNext.addEventListener('click', () => {
                if (inx < naves.attrs.length - 1) {
                    inx++;
                    updateNaveImage();
                    btnPrev.style.opacity = '1';
                    btnPrev.style.pointerEvents = 'all';

                    if (inx === naves.attrs.length - 1) {
                        btnNext.style.opacity = '0.2';
                        btnNext.style.pointerEvents = 'none';
                    }
                }
            });

            btnPrev.addEventListener('click', () => {
                if (inx > 0) {
                    inx--;
                    updateNaveImage();
                    btnNext.style.opacity = '1';
                    btnNext.style.pointerEvents = 'all';

                    if (inx === 0) {
                        btnPrev.style.opacity = '0.2';
                        btnPrev.style.pointerEvents = 'none';
                    }
                }
            });

            window.addEventListener('keyup', event => {
                if (sectionTwo.classList.contains('active')) {
                    const character = playerShip;
                    const containerWidth = gameSection.offsetWidth;
                    const shipWidth = character.offsetWidth;

                    if (event.code === 'ArrowLeft') {
                        posX -= 40;
                        if (posX < 0) {
                            posX = 0;
                        }
                    }

                    if (event.code === 'ArrowRight') {
                        posX += 40;
                        if (posX > containerWidth - shipWidth) {
                            posX = containerWidth - shipWidth;
                        }
                    }
                    character.style.left = `${posX}px`;
                }
            });

            updateNaveImage();
            btnPrev.style.opacity = '0.2';
            btnPrev.style.pointerEvents = 'none';

            // --- Lógica del juego ---
            const scoreDisplay = document.querySelector('.score-display');
            const timerFill = document.querySelector('.timer-fill');
            const healthHearts = document.querySelector('.health-hearts');

            const showExplosion = (x, y) => {
                const explosion = document.createElement('img');
                explosion.src = 'images/explosion.gif';
                explosion.classList.add('explosion');
                explosion.style.left = `${x - 40}px`;
                explosion.style.top = `${y - 40}px`;
                gameSection.appendChild(explosion);
                
                setTimeout(() => {
                    explosion.style.opacity = 1;
                }, 10);

                setTimeout(() => {
                    explosion.style.opacity = 0;
                    explosion.addEventListener('transitionend', () => explosion.remove());
                }, 500);
            };

            const createWorld = () => {
                const world = document.createElement('img');
                const randomImage = worldImages[Math.floor(Math.random() * worldImages.length)];
                const randomPosition = Math.random() * (gameSection.offsetWidth - 60);

                world.src = randomImage;
                world.classList.add('world');
                world.style.left = `${randomPosition}px`;
                gameSection.appendChild(world);

                let currentTop = -50;
                const fallInterval = setInterval(() => {
                    currentTop += 2;
                    world.style.top = `${currentTop}px`;

                    if (currentTop > gameSection.offsetHeight) {
                        world.remove();
                        clearInterval(fallInterval);
                        updateScore(10);
                    }
                }, 20);
            };

            const startWorldGeneration = () => {
                worldGenerationInterval = setInterval(() => {
                    createWorld();
                }, 1000);
            };

            const checkCollisions = () => {
                const worlds = document.querySelectorAll('.world');
                const playerRect = playerShip.getBoundingClientRect();
                const gameRect = gameSection.getBoundingClientRect();

                worlds.forEach(world => {
                    const worldRect = world.getBoundingClientRect();

                    if (playerRect.left < worldRect.right &&
                        playerRect.right > worldRect.left &&
                        playerRect.top < worldRect.bottom &&
                        playerRect.bottom > worldRect.top) {

                        if (!isInvincible) {
                            updateHealth(1);
                            
                            const collisionX = (playerRect.left + playerRect.right) / 2 - gameRect.left;
                            const collisionY = (playerRect.top + playerRect.bottom) / 2 - gameRect.top;
                            showExplosion(collisionX, collisionY);

                            world.remove();
                            isInvincible = true;
                            playerShip.style.opacity = 0.5;

                            setTimeout(() => {
                                isInvincible = false;
                                playerShip.style.opacity = 1;
                            }, 1500);
                        }
                    }
                });
            };

            const updateScore = (points) => {
                score += points;
                scoreDisplay.textContent = String(score).padStart(5, '0');
            };

            const updateHealth = (damage) => {
                health -= damage;
                if (health < 0) health = 0;

                const hearts = healthHearts.querySelectorAll('img');
                hearts.forEach((heart, index) => {
                    if (index >= health) {
                        heart.style.opacity = '0.3';
                    } else {
                        heart.style.opacity = '1';
                    }
                });

                if (health === 0) {
                    endGame();
                }
            };

            const startTimer = () => {
                timerInterval = setInterval(() => {
                    timeLeft--;
                    const timerWidth = (timeLeft / 60) * 150;
                    timerFill.style.width = timerWidth + 'px';

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        endGame();
                    }
                }, 1000);
            };

            const endGame = () => {
                alert(`¡Juego Terminado! Tu puntuación final es: ${score}.`);
                sectionOne.classList.add('active');
                sectionTwo.classList.remove('active');
                document.querySelector('header').style.display = 'block';

                document.querySelectorAll('.world').forEach(world => world.remove());
                clearInterval(worldGenerationInterval);
                clearInterval(timerInterval);
                clearInterval(collisionInterval);

                score = 0;
                health = 3;
                timeLeft = 60;
                scoreDisplay.textContent = '00000';
                timerFill.style.width = '150px';
                const hearts = healthHearts.querySelectorAll('img');
                hearts.forEach(heart => heart.style.opacity = '1');
            };

            btnStart.addEventListener('click', () => {
                sectionOne.classList.remove('active');
                sectionTwo.classList.add('active');
                document.querySelector('header').style.display = 'none';
                startTimer();
                startWorldGeneration();
                collisionInterval = setInterval(checkCollisions, 50);
            });
        });
    </script>
</body>

</html>